name: Manual Deployment Test\n\non:\n  workflow_dispatch:\n    inputs:\n      environment:\n        description: 'Target environment'\n        required: true\n        default: 'staging'\n        type: choice\n        options:\n          - staging\n          - production\n          - development\n      run_integration_tests:\n        description: 'Run integration tests after deployment'\n        required: false\n        default: true\n        type: boolean\n      deploy_backend:\n        description: 'Deploy backend service'\n        required: false\n        default: true\n        type: boolean\n      deploy_frontend:\n        description: 'Deploy frontend service'\n        required: false\n        default: true\n        type: boolean\n\njobs:\n  # Pre-deployment validation\n  pre-deployment-checks:\n    name: Pre-Deployment Validation\n    runs-on: ubuntu-latest\n    \n    outputs:\n      should_deploy_backend: ${{ steps.validation.outputs.backend }}\n      should_deploy_frontend: ${{ steps.validation.outputs.frontend }}\n      environment: ${{ github.event.inputs.environment }}\n      \n    steps:\n      - name: Checkout Code\n        uses: actions/checkout@v4\n\n      - name: Validate Input Parameters\n        id: validation\n        run: |\n          echo \"Environment: ${{ github.event.inputs.environment }}\"\n          echo \"Deploy Backend: ${{ github.event.inputs.deploy_backend }}\"\n          echo \"Deploy Frontend: ${{ github.event.inputs.deploy_frontend }}\"\n          echo \"Run Integration Tests: ${{ github.event.inputs.run_integration_tests }}\"\n          \n          # Set outputs\n          echo \"backend=${{ github.event.inputs.deploy_backend }}\" >> $GITHUB_OUTPUT\n          echo \"frontend=${{ github.event.inputs.deploy_frontend }}\" >> $GITHUB_OUTPUT\n\n      - name: Environment Configuration Check\n        run: |\n          case \"${{ github.event.inputs.environment }}\" in\n            \"staging\")\n              echo \"âœ… Staging environment selected\"\n              echo \"Using staging configuration...\"\n              ;;\n            \"production\")\n              echo \"âš ï¸  Production environment selected\"\n              echo \"Using production configuration...\"\n              ;;\n            \"development\")\n              echo \"ðŸ”§ Development environment selected\"\n              echo \"Using development configuration...\"\n              ;;\n            *)\n              echo \"âŒ Invalid environment specified\"\n              exit 1\n              ;;\n          esac\n\n      - name: Generate Deployment Summary\n        run: |\n          echo \"## ðŸš€ Manual Deployment Test Summary\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### Configuration\" >> $GITHUB_STEP_SUMMARY\n          echo \"- **Environment**: ${{ github.event.inputs.environment }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"- **Backend Deployment**: ${{ github.event.inputs.deploy_backend }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"- **Frontend Deployment**: ${{ github.event.inputs.deploy_frontend }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"- **Integration Tests**: ${{ github.event.inputs.run_integration_tests }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"- **Branch**: ${{ github.ref_name }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"- **Commit**: ${{ github.sha }}\" >> $GITHUB_STEP_SUMMARY\n\n  # Backend deployment simulation\n  deploy-backend:\n    name: Deploy Backend Service\n    runs-on: ubuntu-latest\n    needs: pre-deployment-checks\n    if: needs.pre-deployment-checks.outputs.should_deploy_backend == 'true'\n    \n    steps:\n      - name: Checkout Code\n        uses: actions/checkout@v4\n\n      - name: Setup Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n\n      - name: Install Dependencies\n        working-directory: ./backend\n        run: |\n          python -m pip install --upgrade pip\n          pip install -r requirements.txt\n\n      - name: Build Backend Container\n        working-directory: ./backend\n        run: |\n          docker build -t green-backend:${{ github.sha }} .\n          echo \"âœ… Backend container built successfully\"\n\n      - name: Test Backend Container\n        run: |\n          # Start container in background\n          docker run -d --name test-backend -p 8000:8000 green-backend:${{ github.sha }}\n          \n          # Wait for service to start\n          echo \"Waiting for backend service...\"\n          sleep 10\n          \n          # Test health endpoint\n          curl -f http://localhost:8000/health || exit 1\n          echo \"âœ… Backend health check passed\"\n          \n          # Test API endpoints\n          curl -f http://localhost:8000/ || exit 1\n          curl -f http://localhost:8000/api/hello || exit 1\n          echo \"âœ… Backend API endpoints accessible\"\n          \n          # Cleanup\n          docker stop test-backend\n          docker rm test-backend\n\n      - name: Backend Deployment Status\n        run: |\n          echo \"## ðŸŽ¯ Backend Deployment Status\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### âœ… Completed Steps\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Container build: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Health check: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- API validation: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"**Backend ready for ${{ needs.pre-deployment-checks.outputs.environment }} deployment!**\" >> $GITHUB_STEP_SUMMARY\n\n  # Frontend deployment simulation\n  deploy-frontend:\n    name: Deploy Frontend Service\n    runs-on: ubuntu-latest\n    needs: pre-deployment-checks\n    if: needs.pre-deployment-checks.outputs.should_deploy_frontend == 'true'\n    \n    steps:\n      - name: Checkout Code\n        uses: actions/checkout@v4\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: '18'\n          cache: 'npm'\n          cache-dependency-path: './frontend/package-lock.json'\n\n      - name: Install Dependencies\n        working-directory: ./frontend\n        run: npm ci\n\n      - name: Build Frontend\n        working-directory: ./frontend\n        run: |\n          # Set environment-specific API URL\n          case \"${{ needs.pre-deployment-checks.outputs.environment }}\" in\n            \"staging\")\n              export VITE_API_URL=\"https://api-staging.example.com\"\n              ;;\n            \"production\")\n              export VITE_API_URL=\"https://api.example.com\"\n              ;;\n            \"development\")\n              export VITE_API_URL=\"http://localhost:8000\"\n              ;;\n          esac\n          \n          npm run build\n          echo \"âœ… Frontend build completed\"\n\n      - name: Build Frontend Container\n        working-directory: ./frontend\n        run: |\n          docker build -t green-frontend:${{ github.sha }} .\n          echo \"âœ… Frontend container built successfully\"\n\n      - name: Test Frontend Container\n        run: |\n          # Start container in background\n          docker run -d --name test-frontend -p 3000:3000 green-frontend:${{ github.sha }}\n          \n          # Wait for service to start\n          echo \"Waiting for frontend service...\"\n          sleep 15\n          \n          # Test frontend accessibility\n          curl -f http://localhost:3000 || exit 1\n          echo \"âœ… Frontend accessibility check passed\"\n          \n          # Check if index.html contains expected content\n          if curl -s http://localhost:3000 | grep -q \"Green Hello World\"; then\n            echo \"âœ… Frontend content validation passed\"\n          else\n            echo \"âŒ Frontend content validation failed\"\n            exit 1\n          fi\n          \n          # Cleanup\n          docker stop test-frontend\n          docker rm test-frontend\n\n      - name: Frontend Deployment Status\n        run: |\n          echo \"## ðŸŽ¨ Frontend Deployment Status\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### âœ… Completed Steps\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Build process: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Container build: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Accessibility check: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Content validation: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"**Frontend ready for ${{ needs.pre-deployment-checks.outputs.environment }} deployment!**\" >> $GITHUB_STEP_SUMMARY\n\n  # Integration testing after deployment\n  integration-tests:\n    name: Post-Deployment Integration Tests\n    runs-on: ubuntu-latest\n    needs: [pre-deployment-checks, deploy-backend, deploy-frontend]\n    if: always() && github.event.inputs.run_integration_tests == 'true'\n    \n    steps:\n      - name: Checkout Code\n        uses: actions/checkout@v4\n\n      - name: Run Full Stack Integration Tests\n        run: |\n          # Use docker-compose for integration testing\n          docker-compose -f docker-compose.ci.yml up -d\n          \n          # Wait for services\n          echo \"Waiting for services to start...\"\n          sleep 30\n          \n          # Test backend-frontend integration\n          echo \"Testing full-stack integration...\"\n          \n          # Test backend health\n          curl -f http://localhost:8000/health || exit 1\n          \n          # Test frontend accessibility\n          curl -f http://localhost:3000 || exit 1\n          \n          # Test API endpoints\n          curl -f http://localhost:8000/api/hello || exit 1\n          \n          echo \"âœ… Integration tests passed successfully\"\n\n      - name: Collect Service Logs\n        if: always()\n        run: |\n          echo \"=== Backend Logs ===\"\n          docker-compose -f docker-compose.ci.yml logs backend\n          echo \"=== Frontend Logs ===\"\n          docker-compose -f docker-compose.ci.yml logs frontend\n\n      - name: Cleanup Integration Environment\n        if: always()\n        run: |\n          docker-compose -f docker-compose.ci.yml down -v\n          docker system prune -f\n\n      - name: Integration Test Summary\n        run: |\n          echo \"## ðŸ”— Integration Test Results\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### âœ… Test Results\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Service startup: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Backend health: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- Frontend accessibility: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"- API connectivity: âœ…\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"**All integration tests passed! ðŸŽ‰**\" >> $GITHUB_STEP_SUMMARY\n\n  # Final deployment summary\n  deployment-summary:\n    name: Deployment Summary\n    runs-on: ubuntu-latest\n    needs: [pre-deployment-checks, deploy-backend, deploy-frontend, integration-tests]\n    if: always()\n    \n    steps:\n      - name: Generate Final Summary\n        run: |\n          echo \"## ðŸ“Š Manual Deployment Test - Final Summary\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### ðŸŽ¯ Environment: ${{ needs.pre-deployment-checks.outputs.environment }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### ðŸ“‹ Job Status\" >> $GITHUB_STEP_SUMMARY\n          \n          # Check job results\n          if [[ \"${{ needs.deploy-backend.result }}\" == \"success\" ]] || [[ \"${{ needs.deploy-backend.result }}\" == \"skipped\" ]]; then\n            echo \"- Backend Deployment: âœ…\" >> $GITHUB_STEP_SUMMARY\n          else\n            echo \"- Backend Deployment: âŒ\" >> $GITHUB_STEP_SUMMARY\n          fi\n          \n          if [[ \"${{ needs.deploy-frontend.result }}\" == \"success\" ]] || [[ \"${{ needs.deploy-frontend.result }}\" == \"skipped\" ]]; then\n            echo \"- Frontend Deployment: âœ…\" >> $GITHUB_STEP_SUMMARY\n          else\n            echo \"- Frontend Deployment: âŒ\" >> $GITHUB_STEP_SUMMARY\n          fi\n          \n          if [[ \"${{ needs.integration-tests.result }}\" == \"success\" ]] || [[ \"${{ needs.integration-tests.result }}\" == \"skipped\" ]]; then\n            echo \"- Integration Tests: âœ…\" >> $GITHUB_STEP_SUMMARY\n          else\n            echo \"- Integration Tests: âŒ\" >> $GITHUB_STEP_SUMMARY\n          fi\n          \n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"### ðŸŽ‰ Deployment Test Complete!\" >> $GITHUB_STEP_SUMMARY\n          echo \"\" >> $GITHUB_STEP_SUMMARY\n          echo \"Timestamp: $(date)\" >> $GITHUB_STEP_SUMMARY\n          echo \"Branch: ${{ github.ref_name }}\" >> $GITHUB_STEP_SUMMARY\n          echo \"Commit: ${{ github.sha }}\" >> $GITHUB_STEP_SUMMARY